---
import { getCollection } from "astro:content";

type Props = {
  limit?: number;
  showAll?: boolean;
};

const { limit, showAll = false } = Astro.props as Props;

let items: Array<{
  title: string;
  date: string;
  category: string;
  image: string;
  teaser: string;
  slug?: string;
}> = [];

try {
  const collection = await getCollection("news");
  items = collection
    .map((entry) => ({
      title: entry.data.title,
      date: entry.data.date,
      category: entry.data.category,
      image: entry.data.image,
      teaser: entry.data.teaser,
      slug: entry.slug,
    }))
    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
} catch (err) {
  // Falls Content Collections nicht verf체gbar sind, gibt es einfach eine leere Liste zur체ck.
  items = [];
}

if (limit && limit > 0) {
  items = items.slice(0, limit);
}
---

{items.length === 0 ? (
  <p class="text-sm text-slate-700">Derzeit liegen keine News-Eintr채ge vor. Schau gerne sp채ter wieder vorbei.</p>
) : (
  <div class="grid gap-6 md:grid-cols-3">
    {items.map((item) => (
      <article class="flex flex-col overflow-hidden rounded-2xl border border-[color:var(--tsg-border)] bg-[color:var(--tsg-surface)] shadow-[0_16px_30px_rgba(30,64,175,0.08)]">
        <div class="h-40 w-full overflow-hidden">
          <img
            src={item.image}
            alt={item.title}
            class="h-full w-full object-cover"
            loading="lazy"
            decoding="async"
            width="600"
            height="300"
          />
        </div>
        <div class="flex flex-1 flex-col p-4 text-sm">
          <div class="flex items-center justify-between text-[0.7rem] text-slate-500">
            <span class="rounded-full bg-[color:var(--tsg-surface-muted)] px-2 py-0.5 font-semibold uppercase tracking-[0.16em] text-[color:var(--tsg-primary)]">
              {item.category}
            </span>
            <span>{item.date}</span>
          </div>
          <h2 class="mt-3 text-sm font-semibold text-slate-900 md:text-base">{item.title}</h2>
          <p class="mt-2 flex-1 text-sm text-slate-700">{item.teaser}</p>
          {showAll && item.slug && (
            <a href={`/news/${item.slug}`} class="mt-3 text-xs font-semibold text-[color:var(--tsg-primary)] hover:underline">
              Mehr erfahren
            </a>
          )}
        </div>
      </article>
    ))}
  </div>
)}
